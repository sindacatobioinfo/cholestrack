#===============================================================================
# INTEROMICS SNAKEMAKE WORKFLOW - CONFIGURATION FILE
# Whole Exome Sequencing (WES) Analysis Pipeline
#===============================================================================
#
# This configuration file controls all aspects of the WES analysis workflow.
# Copy this file to a new location (e.g., configfiles/my_config.yaml)
# and customize for your project.
#
# IMPORTANT: Never edit the original config.yaml directly!
#
#===============================================================================

#-------------------------------------------------------------------------------
# PROJECT SETTINGS
#-------------------------------------------------------------------------------

# Project name - used to automatically create input/output directory structure
# Example: If project_name is "my_wes_study", paths will be:
#   - Input:  {base_dir}/{project_name}/samples/
#   - Output: {base_dir}/{project_name}/
project_name: workflow_test

# Base directory where project directories are located
# All input/output paths will be relative to this directory
base_dir: /home/operator/Downloads

#-------------------------------------------------------------------------------
# ANALYSIS TYPE
#-------------------------------------------------------------------------------

# Analysis mode: germline or somatic
germline: True  # Set to False for somatic (tumor-normal) analysis
run_cnv_calling: False
#-------------------------------------------------------------------------------
# TOOL SELECTION
#-------------------------------------------------------------------------------

# Alignment tool selection
# Options: bwa, minimap2
# - bwa: BWA-MEM (default, recommended for short Illumina reads)
# - minimap2: Minimap2 (versatile aligner, supports short/long reads with different presets)
aligner: minimap2

# Legacy config (for backward compatibility - use 'aligner' instead)
# use_bwa: True

# Variant callers (can enable multiple)
use_gatk: True          # GATK HaplotypeCaller (recommended)
use_strelka: True       # Strelka2 germline caller
use_deepvariant: True   # DeepVariant (requires Singularity)

# Annotation tools
run_annovar: True       # Run ANNOVAR annotation (and downstream ETL processing)
run_vep: True           # Run VEP annotation (Variant Effect Predictor)

# Scatter-gather parallelization (10-50x speedup)
use_scatter_gather: True       # Enable parallel GATK HaplotypeCaller (recommended)
use_scatter_gather_bqsr: True  # Enable parallel BQSR (recommended, saves ~3 hours/sample)
scatter_count: 16              # Number of scatter pieces (adjust based on cores)

# Model type for Strelka and DeepVariant (if enabled)
# DeepVariant models: WES (whole exome), WGS (whole genome), PACBIO
# Note: Case-insensitive - will be automatically converted to lowercase for DeepVariant
model_type: WES  # Options: WES, WGS, PACBIO

# Strelka error handling (for problematic BAMs)
strelka_disable_seq_error_estimation: False   # Recommended: True for WES, fixes chrX depth errors
strelka_disable_evs: False                    # Set True if getting assertion failures (less sensitive but more stable)
strelka_max_indel_size: 49                    # Default: 49, reduce to 30-40 if getting complex indel assertion failures

#-------------------------------------------------------------------------------
# ALIGNMENT OPTIMIZATION
#-------------------------------------------------------------------------------
# Extra parameters for aligners to optimize variant calling quality

# BWA-MEM extra parameters (only used if aligner: bwa)
# -M: Mark shorter split hits as secondary (Picard compatibility)
# -Y: Use soft clipping for supplementary alignments (better for GATK variant calling)
bwa_extra: "-M -Y"

# Minimap2 extra parameters (only used if aligner: minimap2)
# -Y: Use soft clipping for supplementary alignments
# --MD: Add MD tag for mismatches (required by GATK)
minimap2_extra: "-Y --MD"

# Minimap2 --eqx flag control
# --eqx: Use =/X CIGAR operators instead of M (more precise alignment, improves variant calling quality)
# WARNING: --eqx is INCOMPATIBLE with Strelka (causes C++ assertion failures)
# When use_strelka is True, --eqx will be automatically disabled regardless of this setting
minimap2_use_eqx: True  # Default: True (recommended for GATK/DeepVariant-only workflows)

#-------------------------------------------------------------------------------
# MINIMAP2 CONFIGURATION
#-------------------------------------------------------------------------------
# Only used if aligner is set to "minimap2"

minimap2:
  # Preset for alignment mode (critical parameter!)
  # Short reads (Illumina):
  #   - sr: Short single-end reads (recommended for Illumina WES/WGS)
  # Long reads:
  #   - map-ont: Oxford Nanopore reads
  #   - map-pb: PacBio CLR reads
  #   - map-hifi: PacBio HiFi/CCS reads (high accuracy)
  # Assembly:
  #   - asm5: Assembly-to-reference (>= 95% identity)
  #   - asm10: Assembly-to-reference (>= 90% identity)
  #   - asm20: Assembly-to-reference (>= 80% identity)
  preset: sr  # Default: sr (for Illumina short reads)

#-------------------------------------------------------------------------------
# INPUT/OUTPUT PATHS
#-------------------------------------------------------------------------------
# IMPORTANT: All paths must end with "/"
#
# NOTE: These paths are automatically constructed from project_name and base_dir.
# To change your project location, simply modify project_name and base_dir above.
# The Snakefile will automatically build the full paths.
#
# Pattern: {base_dir}/{project_name}/samples/ and {base_dir}/{project_name}/
#
# Leave these as "auto" to use automatic path construction, or override with
# custom paths if you have a non-standard directory structure.

# Input directory containing FASTQ files
# Expected naming: {sample}_1.fastq.gz and {sample}_2.fastq.gz
input: auto

# Output directory for all results
output: auto

#-------------------------------------------------------------------------------
# REFERENCE GENOME AND RESOURCES
#-------------------------------------------------------------------------------

refgenome:
  # Reference genome directory
  ref_dir: /home/operator/InterOmics/workflows/interomics_snakemake/reference_genome/

  # Reference FASTA file (must be indexed with .fai and .dict)
  ref: /home/operator/InterOmics/workflows/interomics_snakemake/reference_genome/GRCh38_character_genome.fasta

  # Target regions (BED file for exome capture kit)
  bed: /home/operator/InterOmics/workflows/interomics_snakemake/interval_files/hg38_no_alt.bed.gz

  # Interval list (GATK format, derived from BED)
  interval: /home/operator/InterOmics/workflows/interomics_snakemake/interval_files/hg38_no_alt.interval_list

  # CNV-specific intervals (optional, uses interval if not specified)
  cnv_intervals: /home/operator/InterOmics/workflows/interomics_snakemake/interval_files/hg38_no_alt.interval_list

  # Sequence dictionary
  dict: /home/operator/InterOmics/workflows/interomics_snakemake/reference_genome/GRCh38_character_genome.dict

  # Known variants for BQSR (dbSNP)
  known_var1: /home/operator/InterOmics/workflows/interomics_snakemake/resources/gatk_resources/dbsnp_151.vcf.gz
  known_var2: /home/operator/InterOmics/workflows/interomics_snakemake/resources/gatk_resources/1000G_phase1.snps.high_confidence.hg38.vcf.gz
  known_var3: /home/operator/InterOmics/workflows/interomics_snakemake/resources/gatk_resources/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz

#-------------------------------------------------------------------------------
# TOOL-SPECIFIC PATHS
#-------------------------------------------------------------------------------
# Paths to external tools and databases
# (Previously hard-coded, now configurable)

tools:
  # ANNOVAR installation and database
  annovar:
    basedir: /home/operator/InterOmics/workflows/interomics_snakemake/resources/annovar
    humandb: /home/operator/InterOmics/workflows/interomics_snakemake/resources/annovar/humandb
    convert2annovar: /home/operator/InterOmics/workflows/interomics_snakemake/resources/annovar/convert2annovar.pl
    table_annovar: /home/operator/InterOmics/workflows/interomics_snakemake/resources/annovar/table_annovar.pl

  # DeepVariant Singularity image
  deepvariant_sif: /home/operator/InterOmics/workflows/interomics_snakemake/resources/deepvariant_latest.sif

#-------------------------------------------------------------------------------
# SAMPLE METADATA
#-------------------------------------------------------------------------------

# Library/Capture kit name (for BAM read groups)
library_name: IlluminaTwist  # Will appear in @RG LB tag

# Sequencing platform (for BAM read groups)
platform: NEXTSEQ  # Will appear in @RG PL tag

# Optional: PED file for family/phenotype information (for Peddy)
ped_file: ""  # Leave empty if not available

#-------------------------------------------------------------------------------
# THREAD ALLOCATION
#-------------------------------------------------------------------------------
# Adjust based on available cores and sample count
# Threads are automatically scaled with attempt number for failed jobs

threads:
  others: 1          # Default for most tools
  fastp: 16          # fastp quality control and trimming
  bwa: 16            # BWA-MEM alignment
  minimap2: 16       # Minimap2 alignment (same as BWA by default)

  # DeepVariant single-command workflow (if enabled)
  # Adjust based on your workflow: single sample = higher threads, multi-sample = lower threads for parallelism
  deepvariant: 40    # DeepVariant all steps (make_examples, call_variants, postprocess)

  strelka: 8         # Strelka variant calling
  recal_table: 8     # GATK BaseRecalibrator
  recal_apply: 8     # GATK ApplyBQSR
  annovar: 8         # ANNOVAR annotation (parallel execution)
  vep: 8             # VEP annotation (parallel forking)

#-------------------------------------------------------------------------------
# MEMORY ALLOCATION (in MB)
#-------------------------------------------------------------------------------
# Memory scales automatically with retry attempts

ram_memory:
  markduplicates: 102400  # 100 GB for MarkDuplicates
  recal_table: 102400     # 100 GB for BaseRecalibrator
  bwa: ""                 # Auto-configured

#-------------------------------------------------------------------------------
# VARIANT FILTERING PARAMETERS
#-------------------------------------------------------------------------------

# Exclude filtered variants from final VCF (keep only PASS)
exclude_filtered_variants: True  # Set to False to keep all variants

# Hard filtering thresholds (applied if not using VQSR)
# SNP filters: QD < 2.0 || FS > 60.0 || MQ < 40.0 || MQRankSum < -12.5 || ReadPosRankSum < -8.0
# INDEL filters: QD < 2.0 || FS > 200.0 || ReadPosRankSum < -20.0
# Genotype filter: GQ < 20.0

#-------------------------------------------------------------------------------
# ANNOVAR ANNOTATION PARAMETERS
#-------------------------------------------------------------------------------

annovar:
  build_ver: hg38
  protocols:
    - refGene
    - cytoBand
    - wgRna
    - 1000g2015aug_all
    - gnomad41_genome
    - exac03
    - dbscsnv11
    - dbnsfp47a
    - clinvar_20240917
    - cosmic101
    - avsnp154
  operations: g,r,r,f,f,f,f,f,f,f,f
  nastring: "."

#-------------------------------------------------------------------------------
# VEP ANNOTATION PARAMETERS
#-------------------------------------------------------------------------------

vep:
  # VEP Singularity image file path
  vep_sif: /home/operator/InterOmics/workflows/interomics_snakemake/resources/vep.sif

  # VEP cache directory (relative to workflow directory, auto-downloaded on first run)
  cache_dir: /home/operator/InterOmics/workflows/interomics_snakemake/resources/vep_cache

  # Genome assembly (GRCh37 or GRCh38)
  assembly: GRCh38

  # Species (homo_sapiens, mus_musculus, etc.)
  species: homo_sapiens

  # Cache version ('auto' = use latest available, or specify version like '112')
  cache_version: auto

  # Optional VEP plugins (comma-separated, e.g., "LoF,CADD,dbNSFP")
  plugins: ""

  # Extra VEP options
  # --everything: Includes most annotations
  # --check_existing: Check for co-located known variants
  # --variant_class: Add variant class (SNV, insertion, deletion, etc.)
  extra_options: "--everything --check_existing --variant_class"

#-------------------------------------------------------------------------------
# VEP REANNOTATION PARAMETERS
#-------------------------------------------------------------------------------

# VEP reannotation - re-run VEP on previously annotated VCFs
# Useful when a new VEP version is released or to add new plugins without re-running variant calling
# NOTE: VEP annotation rules are always included when reannotation is enabled
#       If the original VEP files already exist, they won't be recreated
#       Set run_vep: False to avoid recreating VEP files from scratch
run_vep_reannotation: False

vep_reannotation:
  # Cache version for reannotation ('auto' = use latest, or specify version like '112')
  # If different from original VEP version, will show what changed between versions
  # NOTE: Only major versions can be specified (e.g., 115, not 115.2)
  cache_version: auto

  # Skip reannotation if VEP version matches the original annotation
  # Set to True to avoid unnecessary reannotation with same version (unless plugins differ)
  skip_if_same_version: True

  # Plugins for reannotation (can be different from original VEP annotation)
  # Example: "LoF,CADD,/path/to/CADD.tsv.gz,dbNSFP,/path/to/dbNSFP.txt.gz,ALL"
  plugins: ""

  # Extra options for reannotation (can add new annotations)
  extra_options: "--everything --check_existing --variant_class"

  # Fields to compare between original and reannotated VCFs (comma-separated)
  comparison_fields: "CSQ,Consequence,SYMBOL,Gene,Feature,BIOTYPE,IMPACT,Protein_position,Amino_acids,Codons,Existing_variation"

#-------------------------------------------------------------------------------
# QC PARAMETERS
#-------------------------------------------------------------------------------

# Master QC toggle - set to False to disable all QC
run_qc: False

# Granular QC controls (only apply if run_qc is True)
qc_bam_metrics: True        # Collect GC bias, HS, and WGS metrics
qc_vcf_metrics: True        # Collect variant calling metrics and bcftools stats

#-------------------------------------------------------------------------------
# PERFORMANCE OPTIMIZATION
#-------------------------------------------------------------------------------

# Use local storage for intermediate files (shadow directive)
use_shadow: True  # Recommended for network storage setups

# Remove intermediate files after successful completion
remove_intermediate_files: False  # Set to True to clean up intermediate files (saves disk space)

# Generate MD5 checksums for key output files
generate_md5_checksums: True  # Create MD5 hashes for data integrity verification

#-------------------------------------------------------------------------------
# ADVANCED PARAMETERS
#-------------------------------------------------------------------------------

# Additional GATK HaplotypeCaller parameters
haplotypecaller_extra: ""  # e.g., "--native-pair-hmm-threads 4"

# Additional split intervals parameters
split_intervals_extra: ""  # e.g., "--subdivision-mode INTERVAL_SUBDIVISION"

#===============================================================================
# END OF CONFIGURATION
#===============================================================================
#
# For more information and troubleshooting, see:
# - Documentation: documentation/README.md
# - Troubleshooting Guide: documentation/troubleshooting.md
# - Parameter Tuning Guide: documentation/parameter_tuning.md
#
#===============================================================================
